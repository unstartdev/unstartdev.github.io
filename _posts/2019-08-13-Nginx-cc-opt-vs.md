---
layout: post
title: AB测试不同cc-opt编译的Nginx
date: 2019-08-13 19:43:32 +0800
categories: 瞎搞
---
## 前言

暑假要尾声了...望着我的作业

Nginx是用C写的那肯定可以调节编译器的~~玄学~~优化选项

## 开搞

### 准备

- Apache ab一个
- 使用不同编译~~CFLAGS~~选项的Nginx两个

--cc-opt分别如下:

*无优化:*
```
-I /usr/local/include
```

*有优化:*
```
-march=native -O3 -flto -I /usr/local/include
```

### 测试

使用Apache ab进行1000次请求，每次并发100，每个Nginx测试3次取`Connection Times`中的`Total`的平均值

### 结果

|版本|min|mean|\[+/-sd\]|median|max|
|:-----|:-----:|:-----:|:-----:|:-----:|:-----:|
|无优化|7.33333333333333|14.6666666666667|2.66666666666667|12|20.6666666666667|
|有优化|3|14.6666666666667|3.63333333333333|14.3333333333333|25.6666666666667|

有优化的版本最短时间快了4ms，但是不稳定性随即而来`max`时间较长

~~水~~写完了，欢迎订阅，做得不对的请在下方留言