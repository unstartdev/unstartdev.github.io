---
layout: post
title: 定时重启v2ray避免内存满溢
tag: 
---

<p>条件:</p><ul><li>支持systemd的系统</li></ul><a id="more"></a><p>建立一个脚本文件,使用命令<code>vim /usr/local/restart</code><br>文件内容为:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">systemctl restart v2ray</span><br></pre></td></tr></table></figure><p>然后建立一个systemd服务文件(用于重新启动V2Ray)，使用命令<code>vim /etc/systemd/system/restart.service</code><br>文件内容:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Restart V2Ray</span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">ExecStart=/bin/sh /usr/local/restart</span><br></pre></td></tr></table></figure><p>建立Timer定时器文件(重点）,使用命令vim /etc/systemd/system/restart.timer<br>文件内容:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Retart</span><br><span class="line">[Timer]</span><br><span class="line">OnBootSec=24h</span><br><span class="line"><span class="meta">#</span><span class="bash">首次启动后多少小时执行</span></span><br><span class="line">OnUnitActiveSec=24h</span><br><span class="line"><span class="meta">#</span><span class="bash">每隔多少小时执行</span></span><br><span class="line">Unit=restart.service</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>最后执行<code>systemctl start restart.timer &amp;&amp; systemctl enable restart.timer</code></p>
